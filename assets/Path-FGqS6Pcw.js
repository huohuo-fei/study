var W=Object.defineProperty;var X=(f,s,t)=>s in f?W(f,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[s]=t;var a=(f,s,t)=>X(f,typeof s!="symbol"?s+"":s,t);import{V as c,E as z,d as Y,r as I,e as $,c as H,a as k,n as U,f as L,u as F,b as Z,F as J,o as N,_ as q}from"./index-Ck6tq5XS.js";class x{constructor(){a(this,"elements",[1,0,0,0,1,0,0,0,1])}set(s,t,e,n,i,o,r,l,h){const d=this.elements;return d[0]=s,d[1]=n,d[2]=r,d[3]=t,d[4]=i,d[5]=l,d[6]=e,d[7]=o,d[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(s){const t=this.elements,e=s.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this}setFromMatrix4(s){const t=s.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(s){return this.multiplyMatrices(this,s)}premultiply(s){return this.multiplyMatrices(s,this)}multiplyMatrices(s,t){const e=s.elements,n=t.elements,i=this.elements,o=e[0],r=e[3],l=e[6],h=e[1],d=e[4],P=e[7],y=e[2],p=e[5],u=e[8],m=n[0],O=n[3],g=n[6],v=n[1],b=n[4],D=n[7],E=n[2],B=n[5],T=n[8];return i[0]=o*m+r*v+l*E,i[3]=o*O+r*b+l*B,i[6]=o*g+r*D+l*T,i[1]=h*m+d*v+P*E,i[4]=h*O+d*b+P*B,i[7]=h*g+d*D+P*T,i[2]=y*m+p*v+u*E,i[5]=y*O+p*b+u*B,i[8]=y*g+p*D+u*T,this}multiplyScalar(s){const t=this.elements;return t[0]*=s,t[3]*=s,t[6]*=s,t[1]*=s,t[4]*=s,t[7]*=s,t[2]*=s,t[5]*=s,t[8]*=s,this}determinant(){const s=this.elements,t=s[0],e=s[1],n=s[2],i=s[3],o=s[4],r=s[5],l=s[6],h=s[7],d=s[8];return t*o*d-t*r*h-e*i*d+e*r*l+n*i*h-n*o*l}invert(){const s=this.elements,t=s[0],e=s[1],n=s[2],i=s[3],o=s[4],r=s[5],l=s[6],h=s[7],d=s[8],P=d*o-r*h,y=r*l-d*i,p=h*i-o*l,u=t*P+e*y+n*p;if(u===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/u;return s[0]=P*m,s[1]=(n*h-d*e)*m,s[2]=(r*e-n*o)*m,s[3]=y*m,s[4]=(d*t-n*l)*m,s[5]=(n*i-r*t)*m,s[6]=p*m,s[7]=(e*l-h*t)*m,s[8]=(o*t-e*i)*m,this}transpose(){let s;const t=this.elements;return s=t[1],t[1]=t[3],t[3]=s,s=t[2],t[2]=t[6],t[6]=s,s=t[5],t[5]=t[7],t[7]=s,this}transposeIntoArray(s){const t=this.elements;return s[0]=t[0],s[1]=t[3],s[2]=t[6],s[3]=t[1],s[4]=t[4],s[5]=t[7],s[6]=t[2],s[7]=t[5],s[8]=t[8],this}setUvTransform(s,t,e,n,i,o,r){const l=Math.cos(i),h=Math.sin(i);return this.set(e*l,e*h,-e*(l*o+h*r)+o+s,-n*h,n*l,-n*(-h*o+l*r)+r+t,0,0,1),this}scale(s,t){return t||(t=s),this.premultiply(_.makeScale(s,t)),this}rotate(s){return this.premultiply(_.makeRotation(s)),this}translate(s,t){return this.premultiply(_.makeTranslation(s,t)),this}makeTranslation(s,t){return this.set(1,0,s,0,1,t,0,0,1),this}makeRotation(s){const t=Math.cos(s),e=Math.sin(s);return this.set(t,-e,0,e,t,0,0,0,1),this}makeScale(s,t){return this.set(s,0,0,0,t,0,0,0,1),this}equals(s){const t=this.elements,e=s.elements;for(let n=0;n<9;n++)if(t[n]!==e[n])return!1;return!0}fromArray(s,t=0){for(let e=0;e<9;e++)this.elements[e]=s[e+t];return this}clone(){return new x().fromArray(this.elements)}}const _=new x;class Q{constructor(s=0,t=0,e=1){a(this,"position");a(this,"zoom");a(this,"pvmMatrix",new x);this.position=new c(s,t),this.zoom=e}getPvMatrix(){const{position:s,zoom:t}=this;return this.pvmMatrix=new x().scale(1/t).translate(-s.x,-s.y),new x().scale(1/t).translate(-s.x,-s.y)}transformInvert(s){const{position:t,zoom:e}=this;s.translate(-t.x,-t.y),s.scale(1/e,1/e)}}const S=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function G(){const f=Math.random()*4294967295|0,s=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0;return(S[f&255]+S[f>>8&255]+S[f>>16&255]+S[f>>24&255]+"-"+S[s&255]+S[s>>8&255]+"-"+S[s>>16&15|64]+S[s>>24&255]+"-"+S[t&63|128]+S[t>>8&255]+"-"+S[t>>16&255]+S[t>>24&255]+S[e&255]+S[e>>8&255]+S[e>>16&255]+S[e>>24&255]).toLowerCase()}const tt=Math.PI*2;class V extends z{constructor(){super(...arguments);a(this,"position",new c);a(this,"rotate",0);a(this,"scale",new c(1,1));a(this,"offset",new c);a(this,"boundingBox",{min:new c,max:new c});a(this,"visible",!0);a(this,"index",0);a(this,"name","");a(this,"parent");a(this,"enableCamera",!0);a(this,"uuid",G());a(this,"isObject2D",!0)}get matrix(){const{position:t,rotate:e,scale:n}=this,i=new x().makeTranslation(t.x,t.y),o=new x().scale(n.x,n.y),r=new x().rotate(e);return i.multiply(r).multiply(o)}get worldMatrix(){const{parent:t,matrix:e}=this;return t?t.worldMatrix.multiply(e):e}get pvmMatrix(){const t=this.getScene();if(t){const{camera:e}=t;return new x().multiplyMatrices(e.getPvMatrix(),this.worldMatrix)}else return this.worldMatrix}get worldScale(){const{scale:t,parent:e}=this;return e?t.clone().multiply(e.scale):t}transform(t){const{position:e,scale:n,rotate:i}=this;t.translate(e.x,e.y),t.rotate(i),t.scale(n.x,n.y)}decomposeModelMatrix(t){const e=[...t.elements];this.position.set(e[6],e[7]);let n=new c(e[0],e[1]).length();const i=new c(e[3],e[4]).length();t.determinant()<0&&(n=-n),this.scale.set(n,i);let r=Math.atan2(e[1]/n,e[0]/n);r<0&&(r+=tt),this.rotate=r}remove(){const{parent:t}=this;t&&t.remove(this)}getScene(){return"isScene"in this?this:this.parent?this.parent.getScene():null}draw(t){this.visible&&(t.save(),this.transform(t),this.drawShape(t),t.restore())}drawShape(t){}crtPath(t,e){}computeBoundingBox(){}}class j extends V{constructor(t={}){super();a(this,"children",[]);this.setOption(t)}setOption(t){Object.assign(this,t)}add(...t){for(let e of t){if(e===this)return this;e.parent&&e.parent.remove(),e.parent=this,this.children.push(e),this.dispatchEvent({type:"add",target:e})}return this.sort(),this}remove(...t){const{children:e}=this;for(let n of t){const i=e.indexOf(n);if(i!==-1)n.parent=void 0,this.children.splice(i,1),this.dispatchEvent({type:"remove",target:n});else for(let o of e)o instanceof j&&o.remove(n)}}clear(){for(let t of this.children)t.parent=void 0,this.dispatchEvent({type:"removed",target:t});return this.children=[],this}sort(){const{children:t}=this;for(let e of t)e instanceof j?e.sort():t.sort((n,i)=>n.index-i.index)}getObjByProperty(t,e){const{children:n}=this;for(let i=0,o=n.length;i<o;i++){const r=n[i];if(r[t]===e)return r;if(r instanceof j){const l=r.getObjByProperty(t,e);if(l)return l}}}getObjByName(t){return this.getObjByProperty("name",t)}traverse(t){t(this);const{children:e}=this;for(let n of e)n instanceof j?n.traverse(t):t(n)}traverseVisible(t){if(!this.visible)return;t(this);const{children:e}=this;for(let n of e)n.visible&&(n instanceof j?n.traverseVisible(t):t(n))}draw(t){const{children:e}=this;for(let n of e)n.draw(t)}}class et extends j{constructor(t={}){super();a(this,"_canvas",document.createElement("canvas"));a(this,"ctx",this._canvas.getContext("2d"));a(this,"camera",new Q);a(this,"autoClear",!0);a(this,"isScene",!0);this.setOption(t)}get canvas(){return this._canvas}set canvas(t){t!==this._canvas&&(this._canvas=t,this.ctx=this._canvas.getContext("2d"))}setOption(t){for(const[e,n]of Object.entries(t))this[e]=n}render(){const{canvas:{width:t,height:e},ctx:n,camera:i,children:o,autoClear:r}=this;n.save(),r&&n.clearRect(0,0,t,e),n.translate(t/2,e/2);for(let l of o)n.save(),l.enableCamera&&i.transformInvert(n),l.draw(n),n.restore();n.restore()}clientToCanvas(t,e){const{canvas:n}=this,{left:i,top:o}=n.getBoundingClientRect();return new c(t-i,e-o)}canvasToClip({x:t,y:e}){const{canvas:{width:n,height:i}}=this;return new c(t-n/2,e-i/2)}clientToClip(t,e){return this.canvasToClip(this.clientToCanvas(t,e))}isPointInObj(t,e,n=new x){const{ctx:i}=this;return i.beginPath(),t.crtPath(i,n),i.isPointInPath(e.x,e.y)}}const A={type:"change"};class st extends z{constructor(t,e){super();a(this,"camera");a(this,"enableZoom",!0);a(this,"zoomSpeed",3);a(this,"enablePan",!0);a(this,"panSpeed",1);a(this,"panning",!1);a(this,"stage",{cameraPosition:new c(0),cameraZoom:1,panStart:new c(0)});this.camera=t,this.setOption(e)}setOption(t){Object.assign(this,t)}doScale(t){const{enableZoom:e,zoomSpeed:n,camera:i,stage:o}=this;if(!e)return;const r=Math.pow(.9,n);o.cameraZoom=i.zoom,t>0?i.zoom/=r:i.zoom*=r,this.dispatchEvent(A)}pointerdown(t,e){const{enablePan:n,camera:i,stage:{cameraPosition:o,panStart:r}}=this;n&&(this.panning=!0,o.copy(i.position),r.set(t,e))}pointerup(){this.panning=!1}pointermove(t,e){const{enablePan:n,panning:i,camera:o,stage:{panStart:r}}=this;if(!n||!i)return;const l=new c(r.x-t,r.y-e);o.position.add(l),r.set(t,e),this.dispatchEvent(A)}}const K=(f,s,t,e=!0)=>{const n=new c(s[0],s[1]).applyMatrix3(t);f.moveTo(n.x,n.y);for(let i=2,o=s.length;i<o;i+=2){const r=new c(s[i],s[i+1]).applyMatrix3(t);f.lineTo(r.x,r.y)}e&&f.closePath()},C=(f,s,t=!1)=>{const e=new c(s[0],s[1]);f.moveTo(e.x,e.y);for(let n=2,i=s.length;n<i;n+=2){const o=new c(s[n],s[n+1]);f.lineTo(o.x,o.y)}t&&f.closePath()};function nt(f){return function(s,t){for(let e of[...s].reverse())if(f.isPointInObj(e,t,e.pvmMatrix))return e;return null}}class it{constructor(s){a(this,"mousePos",new c);a(this,"center",new c);a(this,"vertices",[]);a(this,"moveVertices",[0,0,14,14,6,14,0,20]);a(this,"rotateVertices",[-10.61,-10.61,-2.83,-9.9,-5.66,-7.07,-2.83,-4.24,-1.41,0,-2.83,4.24,-5.66,7.07,-2.83,9.9,-10.61,10.61,-9.9,2.83,-7.07,5.66,-4.24,2.83,-3.11,0,-4.24,-2.83,-7.07,-5.66,-9.9,-2.83]);a(this,"scaleVertices",[1,4,1,1,5,1,5,5,11,0,5,-5,5,-1,1,-1,1,-4,-1,-4,-1,-1,-5,-1,-5,-5,-11,0,-5,5,-5,1,-1,1,-1,4]);a(this,"fillStyle","#000");a(this,"strokeStyle","#fff");Object.assign(this,s)}scale(s){const{mousePos:t,center:e}=this,n=new c().subVectors(e,t).angle();this.drawScale(s,n)}scaleY(s){const{center:t,vertices:e}=this,n=new c().subVectors(t,new c(e[2],e[3])).angle();this.drawScale(s,n)}scaleX(s){const{center:t,vertices:e}=this,n=new c().subVectors(t,new c(e[6],e[7])).angle();this.drawScale(s,n)}drawScale(s,t){s.rotate(t),s.beginPath(),C(s,this.scaleVertices,!0)}move(s){s.beginPath(),C(s,this.moveVertices,!0)}rotate(s){const{center:t,mousePos:e}=this,n=new c().subVectors(e,t).angle();s.rotate(n),s.beginPath(),C(s,this.rotateVertices,!0)}draw(s,t){if(!t)return;const{fillStyle:e,strokeStyle:n,mousePos:i}=this;s.save(),s.lineWidth=1,s.strokeStyle=n,s.fillStyle=e,s.translate(i.x,i.y),this[t](s),s.fill(),s.stroke(),s.restore()}}const ot=Math.PI*2;class at extends z{constructor(){super(...arguments);a(this,"localMatrix",new x);a(this,"localRotate",0);a(this,"localScale",new c(1));a(this,"localPosition",new c);a(this,"origin",new c);a(this,"relativePosition",new c);a(this,"relativeRotate",0);a(this,"relativeScale",new c(1));a(this,"uniformRotateAng",ot/24)}get matrix(){const{relativePosition:t,relativeRotate:e,relativeScale:n,origin:i,localPosition:o,localRotate:r,localScale:l}=this,h=new x().makeTranslation(-i.x,-i.y);return new x().scale(l.x*n.x,l.y*n.y).rotate(r+e).translate(o.x+t.x,o.y+t.y).clone().multiply(h)}setOrigin(t){this.origin.copy(t),this.localPosition.copy(t.clone().applyMatrix3(this.localMatrix))}setLocalMatrixDataByObject2D(t){this.localMatrix.copy(t.matrix),this.localScale.copy(t.scale),this.localRotate=t.rotate,this.localPosition.copy(t.position)}clearRelativeMatrixData(){this.relativePosition.set(0,0),this.relativeRotate=0,this.relativeScale.set(1,1)}getRelativeScale(t,e){const n=e.clone().rotate(-this.localRotate),i=t.clone().rotate(-this.localRotate);return new c(n.x/i.x,n.y/i.y)}scale0(t,e){this.relativeScale.copy(this.getRelativeScale(t,e))}scale1(t,e){const{x:n,y:i}=this.getRelativeScale(t,e);this.relativeScale.set((n+i)/2)}scaleX0(t,e){this.doScaleSigleDir("x",t,e)}scaleY0(t,e){this.doScaleSigleDir("y",t,e)}scaleX1(t,e){this.doUniformScaleSigleDir("x",t,e)}scaleY1(t,e){this.doUniformScaleSigleDir("y",t,e)}doScaleSigleDir(t,e,n){const i=this.getRelativeScale(e,n);this.relativeScale[t]=i[t]}doUniformScaleSigleDir(t,e,n){const i=this.getRelativeScale(e,n);this.relativeScale.set(i[t])}rotate0(t,e){this.relativeRotate=e.angle()-t.angle()}rotate1(t,e){const{origin:n,uniformRotateAng:i}=this,o=e.angle()-t.angle();this.relativeRotate=Math.floor((o+i/2)/i)*i}move0(t,e){this.relativePosition.subVectors(e,t),this.dispatchEvent({type:"transform",trans:"move",value:e.clone().sub(e)})}move1(){}}let R=!1;const rt=Math.PI*2,w=document.createElement("canvas").getContext("2d");class lt{constructor(s={}){a(this,"_obj",new V);a(this,"localVertices",[]);a(this,"clipVertices",[]);a(this,"nodeIndex",0);a(this,"localCenter",new c);a(this,"clipCenter",new c);a(this,"matrix",new x);a(this,"level","pvmMatrix");a(this,"strokeStyle","#558ef0");a(this,"fillStyle","#fff");a(this,"dotSize",8);for(const[t,e]of Object.entries(s))this[t]=e}get obj(){return this._obj}set obj(s){this._obj=s,s.computeBoundingBox(),this.updateVertices()}get localOpposite(){return this.getOpposite("localVertices")}get clipOpposite(){return this.getOpposite("clipVertives")}getOpposite(s){const{nodeIndex:t}=this,e=this[s],n=(t+8)%16;return new c(e[n],e[n+1])}updateVertices(){const{clipCenter:s,localCenter:t,clipVertices:e,localVertices:n,level:i,obj:o,obj:{boundingBox:{min:{x:r,y:l},max:{x:h,y:d}}}}=this,P=(r+h)/2,y=(l+d)/2;this.localVertices=[r,l,P,l,h,l,h,y,h,d,P,d,r,d,r,y];const p=this.localVertices;this.matrix=o[i];for(let u=0,m=p.length;u<m;u+=2){const{x:O,y:g}=new c(p[u],p[u+1]).applyMatrix3(this.matrix);e[u]=O,e[u+1]=g}t.copy(new c((p[0]+p[8])/2,(p[1]+p[9])/2)),s.copy(new c(e[0],e[1]).lerp(new c(e[8],e[9]),.5))}draw(s){this.updateVertices(),s.save(),s.strokeStyle=this.strokeStyle,s.fillStyle=this.fillStyle,this.drawRectLine(s),this.drawRectControl(s),this.drawRectCenter(s),s.restore()}drawRectLine(s){const{clipVertices:t}=this;s.beginPath();const e=[t[0],t[1],t[4],t[5],t[8],t[9],t[12],t[13]];C(s,e,!0),s.stroke()}drawRectControl(s){const{dotSize:t,obj:{size:{x:e,y:n},boundingBox:{min:{x:i,y:o}}}}=this,[r,l]=[e/2,n/2];s.beginPath();const{elements:h}=this.matrix,d=new c(h[0],h[1]).length(),P=new c(h[3],h[4]).length(),y=new c(t/d,t/P),[p,u]=[y.x/2,y.y/2];for(let m=0;m<3;m++)for(let O=0;O<3;O++){if(m===1&&O===1)continue;const[g,v]=[m*r,O*l],b=[i+g-p,o+v-u,i+g+p,o+v-u,i+g+p,o+v+u,i+g-p,o+v+u];K(s,b,this.matrix,!0)}s.fill(),s.stroke()}drawRectCenter(s){const{clipCenter:t}=this;s.beginPath(),s.arc(t.x,t.y,5,0,rt),s.fill(),s.stroke()}getMouseState(s){const{clipVertices:t}=this,e=new c(t[8]-t[0],t[9]-t[1]).length(),n=Math.min(24,e/3);for(let o=0,r=t.length;o<r;o+=4)if(new c(t[o],t[o+1]).sub(s).length()<=n)return this.nodeIndex=o,"scale";const i=this.getScaleState(n,s);return i||(w.beginPath(),C(w,t,!0),w.isPointInPath(s.x,s.y)?"move":(w.save(),w.lineWidth=80,w.beginPath(),C(w,t,!0),w.fillStyle="red",w.fillRect(-200,-200,1e3,1e3),R=w.isPointInStroke(s.x,s.y),w.restore(),R?"rotate":null))}getScaleState(s,t){const{clipVertices:e}=this,n=[[e[0],e[1],e[12],e[13]],[e[4],e[5],e[8],e[9]],[e[0],e[1],e[4],e[5]],[e[8],e[9],e[12],e[13]]],i=[14,6,2,10];for(let o=0;o<4;o++){const r=o<2?"scaleX":"scaleY",l=this.simpleScale(s,t,n[o],r);if(l)return this.nodeIndex=i[o],l}return null}simpleScale(s,t,e,n){return w.save(),w.lineWidth=s,w.beginPath(),C(w,e,!0),R=w.isPointInStroke(t.x,t.y),w.restore(),R?n:null}}const M={type:"change"};class ct extends V{constructor(){super(...arguments);a(this,"_obj",null);a(this,"frame",new lt);a(this,"index",1/0);a(this,"enableCamera",!1);a(this,"mouseState",null);a(this,"clipMousePos",new c);a(this,"mouseShape",new it({vertices:this.frame.clipVertices,center:this.frame.clipCenter,mousePos:this.clipMousePos}));a(this,"controlState",null);a(this,"dragStart",new c);a(this,"dragEnd",new c);a(this,"start2Origin",new c);a(this,"end2Origin",new c);a(this,"_altKey",!1);a(this,"shiftKey",!1);a(this,"transformer",new at);a(this,"parentPvmInvert",new x);a(this,"controlStage",{position:new c,scale:new c,rotate:0})}get obj(){return this._obj}set obj(t){t!==this._obj&&(this._obj=t,t?(this.frame.obj=t,this.saveTransformData(),this.transformer.setLocalMatrixDataByObject2D(t),this.dispatchEvent({type:"selected",target:t})):(this.mouseState=null,this.controlState=null),this.dispatchEvent(M))}get altKey(){return this._altKey}set altKey(t){if(t===this._altKey)return;this._altKey=t;const{controlState:e}=this;e&&(this.transformer.clearRelativeMatrixData(),this.setOrigin(),this.start2Origin.subVectors(this.dragStart,this.transformer.localPosition),this.end2Origin.subVectors(this.dragEnd,this.transformer.localPosition),this.relativeTransform(e)),this.dispatchEvent(M)}pointerdown(t,e){var i,o;if(!this.mouseState&&(this.obj=t,!t))return;this.clipMousePos.copy(e),this.mouseState=this.frame.getMouseState(e);const n=(o=(i=this.obj)==null?void 0:i.parent)==null?void 0:o.pvmMatrix.invert();n&&this.parentPvmInvert.copy(n),this.mouseState&&(this.dragStart.copy(e.clone().applyMatrix3(this.parentPvmInvert)),this.controlState=this.mouseState,this.obj&&this.transformer.setLocalMatrixDataByObject2D(this.obj),this.setOrigin(),this.start2Origin.subVectors(this.dragStart,this.transformer.localPosition)),this.dispatchEvent(M)}pointermove(t){this.obj&&(this.clipMousePos.copy(t),this.controlState?(this.dragEnd.copy(t.clone().applyMatrix3(this.parentPvmInvert)),this.end2Origin.subVectors(this.dragEnd,this.transformer.localPosition),this.relativeTransform(this.controlState)):this.mouseState=this.frame.getMouseState(t),this.dispatchEvent(M))}pointerup(){const{obj:t,controlState:e,transformer:n}=this;!t||!e||(n.setLocalMatrixDataByObject2D(t),n.clearRelativeMatrixData(),this.controlState=null,this.dispatchEvent(M))}keydown(t,e,n){if(this.altKey=e,this.shiftKey=n,this.obj)switch(t){case"Escape":this.cancleTransform(),this.obj=null;break;case"Enter":this.obj=null;break;case"Delete":this.obj.remove(),this.obj=null;break}this.dispatchEvent(M)}keyup(t,e){this.shiftKey=e,this.altKey=t,this.dispatchEvent(M)}relativeTransform(t){const{transformer:e,start2Origin:n,dragStart:i,dragEnd:o,end2Origin:r,obj:l}=this,h=t+Number(this.shiftKey);!l||!e[h]||(t==="move"?(e[h](i,o),this.dispatchEvent({type:"transforme",value:o.clone().sub(i)})):e[h](n,r),this.dispatchEvent({type:"transformed",obj:l}))}setOrigin(){const{altKey:t,controlState:e,frame:{localCenter:n,localOpposite:i},transformer:o}=this;let r=t||e==="rotate"?n:i;o.setOrigin(r)}saveTransformData(){const{obj:t,controlStage:e}=this;t&&this.passTransformData(t,e)}cancleTransform(){const{obj:t,controlStage:e}=this;t&&this.passTransformData(e,t)}passTransformData(t,e){const{position:n,scale:i,rotate:o}=t;e.position.copy(n),e.scale.copy(i),e.rotate=o}updateFrame(){var t;(t=this.obj)==null||t.computeBoundingBox()}draw(t){const{obj:e}=this;e&&(this.controlState&&e.decomposeModelMatrix(this.transformer.matrix),this.frame.draw(t),this.mouseShape.draw(t,this.mouseState))}}class ht{constructor(){a(this,"shadowColor");a(this,"shadowBlur",0);a(this,"shadowOffsetX",0);a(this,"shadowOffsetY",0);a(this,"globalAlpha");a(this,"globalCompositeOperation");a(this,"clip",!1)}setOption(s={}){Object.assign(this,s)}apply(s){const{globalAlpha:t,globalCompositeOperation:e,shadowBlur:n,shadowColor:i,shadowOffsetX:o,shadowOffsetY:r,clip:l}=this;i&&(s.shadowColor=i,s.shadowBlur=n,s.shadowOffsetX=o,s.shadowOffsetY=r),e&&(s.globalCompositeOperation=e),t&&(s.globalAlpha=t),l&&s.clip()}}class dt extends ht{constructor(t={}){super();a(this,"strokeStyle");a(this,"fillStyle");a(this,"lineWidth",1);a(this,"lineDash");a(this,"lineDashOffset",0);a(this,"lineCap","butt");a(this,"lineJoin","miter");a(this,"miterLimit",10);a(this,"order",0);this.setOption(t)}setOption(t={}){Object.assign(this,t)}get drawOrder(){return this.order?["fill","stroke"]:["stroke","fill"]}apply(t){super.apply(t);const{fillStyle:e,strokeStyle:n,lineWidth:i,lineCap:o,lineJoin:r,miterLimit:l,lineDash:h,lineDashOffset:d}=this;n&&(t.strokeStyle=n,t.lineWidth=i,t.lineCap=o,t.lineJoin=r,t.miterLimit=l,h&&(t.setLineDash(h),t.lineDashOffset=d)),e&&(t.fillStyle=e)}}let ft=class extends V{constructor(t={}){super();a(this,"pointArr",[]);a(this,"style",new dt);a(this,"mode","normal");this.setOption(t)}get size(){const{boundingBox:{min:t,max:e},pointArr:n}=this;return new c(e.x-t.x,e.y-t.y)}start(t){this.pointArr.push(t)}doing(t){var e;this.pointArr.push(t),(e=this.getScene())==null||e.render()}end(t){var e;this.pointArr.push(t),(e=this.getScene())==null||e.render()}setOption(t={}){for(let[e,n]of Object.entries(t))e==="style"||e==="mode"?this.style.setOption(n):this[e]=n}computeBoundingBox(){const{boundingBox:{min:t,max:e},pointArr:n}=this,i=new c,o=new c;for(let r=0,l=n.length;r<l;r++){if(r===0){i.x=n[r].x,i.y=n[r].y,o.x=n[r].x,o.y=n[r].y;continue}i.x>n[r].x&&(i.x=n[r].x),i.y>n[r].y&&(i.y=n[r].y),o.x<n[r].x&&(o.x=n[r].x),o.y<n[r].y&&(o.y=n[r].y)}t.set(i.x,i.y),e.set(o.x,o.y)}crtPath(t,e=this.pvmMatrix){this.computeBoundingBox();const{boundingBox:{min:{x:n,y:i},max:{x:o,y:r}}}=this;K(t,[n,i,o,i,o,r,n,r],e)}drawShape(t){const{style:e,pointArr:n}=this;if(e.apply(t),t.beginPath(),this.mode==="normal")for(let i=0,o=n.length;i<o;i++){if(i===0){t.moveTo(n[i].x,n[i].y);continue}t.lineTo(n[i].x,n[i].y)}t.stroke()}};const ut=["width","height"],pt={class:"operate"},mt=Y({__name:"Path",props:{size:{type:Object,default:{width:0,height:0}}},setup(f){const s=Z(),t=I(),e=new et,n=new st(e.camera,{}),i=nt(e),o=new ct;e.add(o);const r=I("default"),l=()=>{o.mouseState?r.value="none":d?r.value="pointer":r.value="default"};n.addEventListener("change",()=>{e.render()}),o.addEventListener("change",()=>{e.render()});let h,d;function P(p){var u,m,O;(u=t.value)==null||u.addEventListener("pointerdown",({clientX:g,clientY:v})=>{const b=e.clientToClip(g,v);y.value==="draw"?(h=new ft,e.add(h),h.start(b)):(d=i(e.children,b),o.pointerdown(d,b),l())}),(m=t.value)==null||m.addEventListener("pointermove",({clientX:g,clientY:v})=>{const b=e.clientToClip(g,v);h&&y.value==="draw"?h.doing(b):(o.pointermove(b),d=i(e.children,b),l())}),(O=t.value)==null||O.addEventListener("pointerup",({clientX:g,clientY:v})=>{const b=e.clientToClip(g,v);h&&y.value==="draw"?(h.end(b),h=null):o.pointerup()}),window.addEventListener("keydown",({key:g,altKey:v,shiftKey:b})=>{o.keydown(g,v,b),l()}),window.addEventListener("keyup",({altKey:g,shiftKey:v})=>{o.keyup(g,v)})}$(()=>{const p=t.value,u=p==null?void 0:p.getContext("2d");p&&u&&(e.setOption({canvas:p}),P())});const y=I("draw");return(p,u)=>(N(),H(J,null,[k("canvas",{style:U({cursor:r.value}),ref_key:"canvasRef",ref:t,width:f.size.width,height:f.size.height},null,12,ut),k("div",pt,[k("button",{class:L(y.value==="draw"?"active":""),onClick:u[0]||(u[0]=m=>y.value="draw")}," draw ",2),k("button",{class:L(y.value==="select"?"active":""),onClick:u[1]||(u[1]=m=>y.value="select")}," select ",2),k("button",{onClick:u[2]||(u[2]=m=>F(s).replace("/"))}," Home ")])],64))}}),bt=q(mt,[["__scopeId","data-v-371b686b"]]);export{bt as default};
