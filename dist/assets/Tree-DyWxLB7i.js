var f=Object.defineProperty;var g=(h,e,t)=>e in h?f(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var s=(h,e,t)=>g(h,typeof e!="symbol"?e+"":e,t);import{d as v,e as p,c as u,o as m,_ as w}from"./index-B5-EKOCl.js";const L={level:1,title:"1",star:99,children:[{level:2,title:"2",star:12,children:[{level:3,title:"3-1",star:6,children:[{level:4,title:"4",star:12,children:[]}]},{level:3,title:"3-2",star:8,children:[{level:4,title:"4",star:4,children:[{level:5,title:"5",star:3,children:[{level:6,title:"6",star:7,children:[{level:7,title:"7-2",star:24,children:[{level:8,title:"8",star:2,children:[]}]},{level:7,title:"7-1",star:10,children:[{level:8,title:"8-5",star:6,children:[]},{level:8,title:"8-4",star:5,children:[{level:9,title:"9",star:24,children:[]}]},{level:8,title:"8-3",star:12,children:[{level:9,title:"9",star:12,children:[]}]},{level:8,title:"8-2",star:7,children:[]},{level:8,title:"8-1",star:4,children:[{level:9,title:"9",star:15,children:[{level:10,title:"10",star:13,children:[]}]}]}]}]}]}]}]}]}]};var l=(h=>(h.none="none",h.pedding="pedding",h.resolve="resolve",h))(l||{}),o=(h=>(h.none="none",h.active="active",h.link="link",h))(o||{});const T={width:100,height:50,gapW:20,gapH:10,lineWidth:1,lineColor:"#000000",fontSize:20,fontColor:"#ffffff",leftPedding:10};class C{constructor(e,t,i){s(this,"parent");s(this,"children");s(this,"config");s(this,"originData");s(this,"state",l.none);s(this,"optState",o.none);s(this,"x",0);s(this,"y",0);s(this,"offsetX",0);s(this,"offsetY",0);s(this,"depth");this.parent=e,this.children=[],this.config=Object.assign({},T,i),this.originData=t,this.x=this.config.width/2,this.y=this.config.height/2,this.offsetX=0,this.offsetY=1,this.depth=0}setState(e){this.state=e}setDepth(e){this.depth=e}get absY(){return this.offsetY-this.y}calcPosAndSize(e){if(this.state===l.none){const t=this.originData.level;this.offsetX=(this.config.gapW+this.config.width)*(t-1),this.offsetY=0}else if(this.parent&&this.state===l.pedding){const t=this.originData.level;this.offsetX=(this.config.gapW+this.config.width)*(t-1),this.offsetY=(this.config.gapH+this.config.height)*this.depth,this.parent.setDepth(this.depth)}}render(e){e.save(),e.translate(this.offsetX,-this.offsetY),this.renderText(e),this.renderRect(e),this.renderLink(e),e.restore()}renderText(e){const t=this.config.leftPedding,i=(this.config.height-this.config.fontSize)/2;e.fillText(this.originData.title,t,i)}renderRect(e){e.save(),e.beginPath(),e.moveTo(0,0),e.lineTo(this.config.width,0),e.lineTo(this.config.width,this.config.height),e.lineTo(0,this.config.height),e.closePath(),e.stroke(),e.restore()}renderLink(e){if(this.children.length)if(this.children.length===1)e.beginPath(),e.moveTo(this.config.width,this.config.height/2),e.lineTo(this.config.width+this.config.gapW,this.config.height/2),e.stroke();else{let t=-1/0;for(let i=0;i<this.children.length;i++){const n=this.children[i];n.renderPerLine(e),t=Math.max(t,n.absY)}e.beginPath(),e.moveTo(this.config.width,this.config.height/2),e.lineTo(this.config.width+this.config.gapW/2,this.config.height/2),e.lineTo(this.config.width+this.config.gapW/2,-t),e.stroke()}}renderPerLine(e){e.save(),e.beginPath(),e.translate(this.config.width+this.config.gapW,-this.offsetY),e.moveTo(0,this.config.height/2),e.lineTo(-this.config.gapW/2,this.config.height/2),e.stroke(),e.restore()}renderLine(e){e.save(),e.translate(this.offsetX,-this.offsetY),this.renderRect(e),this.renderLink(e),e.restore()}changeStyle(e){}}class y{constructor(e,t){s(this,"dom");s(this,"options");s(this,"levelArray",[]);s(this,"treeGraph");s(this,"listMaxLevel",0);s(this,"listMaxLevelNode");s(this,"cacheCanvas");s(this,"ctx");this.dom=e,this.options=t,this.cacheCanvas=document.createElement("canvas"),this.cacheCanvas.width=this.dom.clientWidth,this.cacheCanvas.height=this.dom.clientHeight,this.ctx=this.cacheCanvas.getContext("2d"),this.dom.appendChild(this.cacheCanvas)}start(){this.treeGraph=this.buildTree(null,this.options.data),this.findLastNode(this.treeGraph,this.listMaxLevel),this.resetCanvasSize(),this.calculateNodePosition(this.listMaxLevelNode),this.draw()}buildTree(e,t){const i=new C(e,t,this.options.config);for(let n=0;n<t.children.length;n++){const r=this.buildTree(i,t.children[n]);i.children.push(r)}return i}resetCanvasSize(){const e={canvasOfX:200},t=1500;this.cacheCanvas.width=t,this.ctx.translate(e.canvasOfX/2,400),this.ctx.strokeStyle="red",this.ctx.font="20px serif",this.ctx.textBaseline="top",this.ctx.fillStyle="#ffffff",this.registerEvent()}findLastNode(e,t){if(e.children.length===0)return t>this.listMaxLevel&&(this.listMaxLevelNode=e,this.listMaxLevel=t),1;let i=0;for(let n=0;n<e.children.length;n++){const r=this.findLastNode(e.children[n],t+1);i=Math.max(i,r)}return i+=1,i}calculateNodePosition(e){const t=e.originData.level-1;this.levelArray[t]||(this.levelArray[t]=[]),e.calcPosAndSize(this.ctx),e.setState(l.resolve),this.levelArray[t].push(e);for(let i=0;i<e.children.length;i++){const n=e.children[i];n.state!==l.resolve&&this.calcSub(n)}e.parent&&this.calculateNodePosition(e.parent)}calcSub(e){const t=e.originData.level-1,i=this.levelArray[t],n=i.length,r=e.parent.depth,c=Math.max(r,n);e.setState(l.pedding),e.setDepth(c),i.push(e);for(let a=0;a<e.children.length;a++){const d=e.children[a];this.calcSub(d)}e.calcPosAndSize(this.ctx)}draw(){for(let e=0;e<this.levelArray.length;e++){const t=this.levelArray[e];for(let i=0;i<t.length;i++)t[i].render(this.ctx)}}registerEvent(){this.cacheCanvas.addEventListener("pointerdown",e=>{this.highLine(e.offsetX,e.offsetY)})}highLine(e,t){this.updateCanvas()}updateCanvas(){const e=document.createElement("canvas");e.width=this.cacheCanvas.width,e.height=this.cacheCanvas.height;const t=e.getContext("2d");t.strokeStyle="green",this.listMaxLevelNode.renderLine(t),this.ctx.drawImage(e,0,0)}}const b={class:"box"},P=v({__name:"Tree",setup(h){return p(()=>{const e=document.querySelector(".box"),t=new y(e,{data:L});t.start(),console.log(t)}),(e,t)=>(m(),u("div",b))}}),k=w(P,[["__scopeId","data-v-2d86c608"]]);export{k as default};
